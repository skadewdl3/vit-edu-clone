---
import Icon from '@components/Icon.vapor.vue'
import { Image } from 'astro:assets'
import Menu from '@components/Menu.vapor.vue'
import logo from '@assets/images/logo.png'
import NavbarLinks from '@components/NavbarLinks.vapor.vue'
import { navColor as navColorAtom } from '@store/menu'

const navColor = navColorAtom.get()
console.log(navColor)
---

<script>
  import { isMenuOpen } from '@store/menu'
  import { throttle } from 'lodash'
  import { navColor as navColorAtom } from '@store/menu'

  const openMenu = () => isMenuOpen.set(true)

  document.querySelector('.menu-trigger').addEventListener('click', openMenu)
  let navbar = document.querySelector('.navbar')
  let image = document.querySelector('.menu-logo-img')
  let logo = document.querySelector('.menu-logo')
  let sublogo = document.querySelector('.menu-sub-logo')

  let navIsSmall = false

  const scrollListener = throttle(e => {
    if (document.documentElement.scrollTop >= 50 && !navIsSmall) {
      navbar.classList.remove('px-60', 'py-8', 'text-white')
      navbar.classList.add('px-20', 'py-4', 'bg-white/80', 'opacity-90', 'text-black')
      image.classList.remove('w-28')
      image.classList.add('w-20')
      logo.classList.add('text-4xl')
      logo.classList.remove('text-6xl')
      sublogo.classList.remove('px-28')
      sublogo.classList.add('text-lg', 'px-20')
      navColorAtom.set('dark')
      navIsSmall = true

    } else if (document.documentElement.scrollTop < 50 && navIsSmall) {
      navbar.classList.add('px-60', 'py-8', 'text-black')
      navbar.classList.remove('px-20', 'py-4', 'bg-white/80', 'opacity-90', 'text-white')
      image.classList.add('w-28')
      image.classList.remove('w-20')
      logo.classList.remove('text-4xl')
      logo.classList.add('text-6xl')
      sublogo.classList.add('px-28')
      sublogo.classList.remove('text-lg', 'px-20')
      navColorAtom.set('light')
      navIsSmall = false
    }
  }, 100)

  window.addEventListener('scroll', scrollListener)
</script>

<div>
  <div class="hidden px-20 py-4 fixed text-4xl"></div>
  <div
    class="navbar transition-all bg-white/0 fixed top-0 left-0 z-10 px-60 py-8 w-full flex items-center justify-between"
    class:list={{
      'text-white': navColor == 'light',
      'text-black': navColor == 'dark',
    }}
  >
    <div class="navbar-left flex flex-col items-start justify-center">
      <div class="menu-logo-main flex items-end justify-start">
        <div class="menu-logo-img w-28 aspect-square">
          <Image
            slot="logo"
            alt="Vishwakarma Institute of Technology Logo"
            src={logo}
          />
        </div>
        <div class="menu-logo font-heading text-6xl">ishwakarma</div>
      </div>

      <div class="menu-sub-logo font-heading text-2xl px-28">
        Institute of Technology
      </div>
    </div>
    <div class="navbar-right flex flex-col items-end justify-start w-[80%]">
      <div class="navbar-right-top">
        <button
          class="bg-accent menu-trigger flex items-center justify-center text-2xl text-bold uppercase px-8 py-4 text-white"
        >
          <span>Menu</span>
          <Icon name="bars-2" class="w-8 ml-4" />
        </button>
      </div>

      <NavbarLinks client:load />
    </div>
  </div>

  <Menu client:load>
    <div
      class="menu-bar w-full my-4 mb-40 bg-red flex items-center justify-between"
      slot="menu-bar"
    >
      <div class="menu-bar-left flex flex-col items-start justify-center">
        <div class="menu-logo-main flex items-end justify-start">
          <div class="menu-logo-img w-28 aspect-square">
            <!-- Using Astro's built in Image component gives better optimisation for images -->
            <Image
              slot="logo"
              alt="Vishwakarma Institute of Technology Logo"
              src={logo}
            />
          </div>
          <div class="menu-logo font-heading text-6xl">ishwakarma</div>
        </div>

        <div class="menu-logo font-heading text-2xl px-28">
          Institute of Technology
        </div>
      </div>
      <button
        class="menu-close text-3xl flex items-center justify-end cursor-pointer text-gray-400 hover:text-white transition-colors"
      >
        Close

        <!-- Even though Icon is also an island, it won't ship with any javascript.
               It will be rendered on server and only html/css will be sent to browser. -->
        <Icon name="x-circle" class="ml-4 w-16" />
      </button>
    </div>
    <Icon name="chevron-right" class="w-8" slot="arrow-right" />
  </Menu>
</div>

<style>
  .fixed {
    position: fixed;
  }
</style>
